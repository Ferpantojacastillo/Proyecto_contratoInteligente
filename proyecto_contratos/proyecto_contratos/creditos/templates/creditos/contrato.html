{% extends 'usuarios/base.html' %}
{% block content %}
<div class="card p-4">
  <h3>Contrato de Liberación de Crédito</h3>
  <p><strong>Alumno:</strong> {{ credito.alumno.get_full_name|default:credito.alumno.username }} ({{ credito.alumno.username }})</p>
  <p><strong>Nombre del crédito:</strong> {{ credito.nombre }}</p>
  <p><strong>Tipo:</strong> {{ credito.get_tipo_display }}</p>
  <p><strong>Semestre:</strong> {{ credito.semestre }}</p>
  <p><strong>Número de control:</strong> {{ credito.numero_control }}</p>
  <p><strong>Fecha de liberación:</strong> {{ credito.fecha_liberacion|default:"-" }}</p>
  <hr>
  <p>Firmas:</p>
  <ul>
    {# Eliminado el estado "Firmado por Administrador" segun nueva política #}
    <li>Docente firmado: {% if credito.firmado_docente %}✅ Sí{% else %}❌ No{% endif %}
        {% if credito.firmado_docente_por %}- por {{ credito.firmado_docente_por.username }} en {{ credito.firmado_docente_en|date:"Y-m-d H:i" }}{% endif %}
    </li>
    <li>Alumno firmado: {% if credito.firmado_alumno %}✅ Sí{% else %}❌ No{% endif %}
        {% if credito.firmado_alumno_por %}- por {{ credito.firmado_alumno_por.username }} en {{ credito.firmado_alumno_en|date:"Y-m-d H:i" }}{% endif %}
    </li>
  </ul>

  <div class="d-flex gap-2 mt-3">
    {% if not credito.firmado_alumno %}
      {% if credito.alumno == user %}
        <form method="post" action="{% url 'firmar_por_alumno' credito.id %}" style="display:inline;">
          {% csrf_token %}
          <button type="submit" class="btn btn-primary">Firmar (Alumno)</button>
        </form>
      {% elif not credito.alumno and credito.numero_control and user.numero_control and credito.numero_control == user.numero_control %}
        <form method="post" action="{% url 'firmar_por_alumno' credito.id %}" style="display:inline;">
          {% csrf_token %}
          <button type="submit" class="btn btn-primary">Firmar (Alumno)</button>
        </form>
      {% endif %}
    {% endif %}
    <a href="{% url 'mis_creditos' %}" class="btn btn-secondary">Volver</a>
  </div>
</div>
{% endblock %}
