{% extends 'usuarios/base.html' %}
{% load static %}

{% block content %}
<div class="container mt-4">
  <h2 class="mb-4">Panel del Docente</h2>

  <!-- Sección de Actividades -->
  <div class="card mb-5">
    <div class="card-header bg-primary text-white">
      <h4 class="mb-0">Actividades Disponibles</h4>
    </div>
    <div class="card-body">
      {% if actividades %}
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Nombre de Actividad</th>
                <th>Descripción</th>
                <th>Fecha</th>
                <th>Capacidad</th>
              </tr>
            </thead>
            <tbody>
              {% for actividad in actividades %}
              <tr>
                <td><strong>{{ actividad.nombre }}</strong></td>
                <td>{{ actividad.descripcion|truncatewords:15 }}</td>
                <td>{{ actividad.fecha|date:"d/m/Y" }}</td>
                <td>{{ actividad.capacidad }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <p class="text-muted">No hay actividades registradas en el sistema.</p>
      {% endif %}
    </div>
  </div>

  <!-- Sección de Créditos para Firmar -->
  <div class="card mb-5">
    <div class="card-header bg-warning text-dark">
      <h4 class="mb-0">Créditos para Firmar</h4>
    </div>
    <div class="card-body">
      {% if creditos %}
        <div class="alert alert-info">
          <strong>{{ creditos|length }}</strong> crédito(s) pendiente(s) de tu firma. 
          (El administrador ya asignó estas actividades)
        </div>
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>ID</th>
                <th>Nombre del Crédito</th>
                <th>Alumno</th>
                <th>Número de Control</th>
                <th>Tipo</th>
                <th>Semestre</th>
                <th>Firmado por Alumno</th>
                <th>Acción</th>
              </tr>
            </thead>
            <tbody>
              {% for c in creditos %}
              <tr>
                <td><strong>#{{ c.id }}</strong></td>
                <td>{{ c.nombre }}</td>
                <td>{% if c.alumno %}{{ c.alumno.username }}{% else %}-{% endif %}</td>
                <td>{{ c.numero_control }}</td>
                <td><span class="badge bg-secondary">{{ c.get_tipo_display }}</span></td>
                <td>{{ c.semestre }}</td>
                <td>
                  {% if c.firmado_alumno %}
                    <span class="badge bg-success">✓ Sí</span>
                  {% else %}
                    <span class="badge bg-danger">✗ Pendiente</span>
                  {% endif %}
                </td>
                <td>
                    <form method="post" action="{% url 'firmar_por_docente' c.id %}" style="display: inline;">
                      {% csrf_token %}
                      <button type="submit" class="btn btn-success btn-sm">
                        {% if c.firmado_alumno %}Firmar{% else %}Firmar (Alumno pendiente){% endif %}
                      </button>
                    </form>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <p class="text-success"><strong>✓</strong> No hay créditos pendientes por firmar. ¡Todo al día!</p>
      {% endif %}
    </div>
  </div>

</div>
{% endblock %}
